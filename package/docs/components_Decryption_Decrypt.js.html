<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>components/Decryption/Decrypt.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AdditionalDetails.html">AdditionalDetails</a><ul class='methods'><li data-type='method'><a href="module-AdditionalDetails.html#~AdditionalDetails">AdditionalDetails</a></li><li data-type='method'><a href="module-AdditionalDetails.html#~AdditionalDetails">AdditionalDetails</a></li></ul></li><li></li><li><a href="module-ApprovalForm.html">ApprovalForm</a><ul class='methods'><li data-type='method'><a href="module-ApprovalForm.html#~ApprovalForm">ApprovalForm</a></li><li data-type='method'><a href="module-ApprovalForm.html#~ApprovalForm">ApprovalForm</a></li></ul></li><li></li><li><a href="module-EmployeeVisitForm.html">EmployeeVisitForm</a><ul class='methods'><li data-type='method'><a href="module-EmployeeVisitForm.html#~EmployeeVisitForm">EmployeeVisitForm</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~EmployeeVisitForm">EmployeeVisitForm</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~calculateDuration">calculateDuration</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~calculateDuration">calculateDuration</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~stripNonEnglish">stripNonEnglish</a></li><li data-type='method'><a href="module-EmployeeVisitForm.html#~stripNonEnglish">stripNonEnglish</a></li></ul></li><li></li><li><a href="module-SaveandHold.html">SaveandHold</a><ul class='methods'><li data-type='method'><a href="module-SaveandHold.html#~SaveandHold">SaveandHold</a></li><li data-type='method'><a href="module-SaveandHold.html#~SaveandHold">SaveandHold</a></li><li data-type='method'><a href="module-SaveandHold.html#~calculateDuration">calculateDuration</a></li><li data-type='method'><a href="module-SaveandHold.html#~calculateDuration">calculateDuration</a></li><li data-type='method'><a href="module-SaveandHold.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method'><a href="module-SaveandHold.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method'><a href="module-SaveandHold.html#~getToColumnHtml">getToColumnHtml</a></li><li data-type='method'><a href="module-SaveandHold.html#~getToColumnHtml">getToColumnHtml</a></li></ul></li><li></li><li><a href="module-components_Roadmap.html">components/Roadmap</a><ul class='methods'><li data-type='method'><a href="module-components_Roadmap.html#~Roadmap">Roadmap</a></li></ul></li><li><a href="module-src_components_UIShowcase.html">src/components/UIShowcase</a><ul class='methods'><li data-type='method'><a href="module-src_components_UIShowcase.html#~UIShowcase">UIShowcase</a></li></ul></li><li><a href="module-src_components_authentication_OtpVerification.html">src/components/authentication/OtpVerification</a><ul class='methods'><li data-type='method'><a href="module-src_components_authentication_OtpVerification.html#~addTrustedDevice">addTrustedDevice</a></li><li data-type='method'><a href="module-src_components_authentication_OtpVerification.html#~generateDeviceFingerprint">generateDeviceFingerprint</a></li><li data-type='method'><a href="module-src_components_authentication_OtpVerification.html#~getDeviceInfo">getDeviceInfo</a></li><li data-type='method'><a href="module-src_components_authentication_OtpVerification.html#~removeTrustedDevice">removeTrustedDevice</a></li></ul></li><li><a href="module-src_components_ui.html">src/components/ui</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui.html#~AnimatedSlide">AnimatedSlide</a></li><li data-type='method'><a href="module-src_components_ui.html#~CardStyle">CardStyle</a></li></ul></li><li></li><li></li><li></li><li><a href="module-src_components_ui_Alerts.html">src/components/ui/Alerts</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Alerts.html#~Alerts">Alerts</a></li></ul></li><li><a href="module-src_components_ui_Avatar.html">src/components/ui/Avatar</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Avatar.html#~Avatar">Avatar</a></li></ul></li><li><a href="module-src_components_ui_Badge.html">src/components/ui/Badge</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Badge.html#~Badge">Badge</a></li></ul></li><li><a href="module-src_components_ui_Button.html">src/components/ui/Button</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Button.html#~Button">Button</a></li><li data-type='method'><a href="module-src_components_ui_Button.html#~ButtonGroup">ButtonGroup</a></li><li data-type='method'><a href="module-src_components_ui_Button.html#~NavigationContainer">NavigationContainer</a></li></ul></li><li><a href="module-src_components_ui_Card.html">src/components/ui/Card</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Card.html#~Card">Card</a></li></ul></li><li><a href="module-src_components_ui_Checkbox.html">src/components/ui/Checkbox</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Checkbox.html#~Checkbox">Checkbox</a></li></ul></li><li><a href="module-src_components_ui_DialogBox.html">src/components/ui/DialogBox</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_DialogBox.html#~DialogBox">DialogBox</a></li></ul></li><li><a href="module-src_components_ui_Dropdown.html">src/components/ui/Dropdown</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Dropdown.html#~Dropdown">Dropdown</a></li></ul></li><li><a href="module-src_components_ui_Input.html">src/components/ui/Input</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_Input.html#~Input">Input</a></li></ul></li><li><a href="module-src_components_ui_Pagination.html">src/components/ui/Pagination</a></li><li><a href="module-src_components_ui_PriorityIcon.html">src/components/ui/PriorityIcon</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_PriorityIcon.html#~PriorityIcon">PriorityIcon</a></li></ul></li><li><a href="module-src_components_ui_TextArea.html">src/components/ui/TextArea</a><ul class='methods'><li data-type='method'><a href="module-src_components_ui_TextArea.html#~TextArea">TextArea</a></li></ul></li><li><a href="module-src_layouts_full_header_Profile.html">src/layouts/full/header/Profile</a></li><li><a href="module-src_pages_Inbox_Inbox.html">src/pages/Inbox/Inbox</a></li><li><a href="module-src_services_EnhancedDynamicDecryption.html">src/services/EnhancedDynamicDecryption</a><ul class='methods'><li data-type='method'><a href="module-src_services_EnhancedDynamicDecryption.html#~base64ToArrayBuffer">base64ToArrayBuffer</a></li><li data-type='method'><a href="module-src_services_EnhancedDynamicDecryption.html#~getAuthHeaders">getAuthHeaders</a></li></ul></li><li><a href="module-src_views_authentication_auth_AuthLogin.html">src/views/authentication/auth/AuthLogin</a></li><li><a href="module-src_views_authentication_auth_encryption.html">src/views/authentication/auth/encryption</a><ul class='methods'><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.authenticateUser">authenticateUser</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.decryptGCM">decryptGCM</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.encryptECB">encryptECB</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.getDecryptKeyFromCookies">getDecryptKeyFromCookies</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.getSessionIdFromCookies">getSessionIdFromCookies</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.getUserFromCookies">getUserFromCookies</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.isUserAuthenticated">isUserAuthenticated</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#.logoutUser">logoutUser</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~deleteCookie">deleteCookie</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~generate256BitKey">generate256BitKey</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~getAuthHeaders">getAuthHeaders</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~getCookie">getCookie</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~insertSessionData">insertSessionData</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~saveUserToCookies">saveUserToCookies</a></li><li data-type='method'><a href="module-src_views_authentication_auth_encryption.html#~setCookie">setCookie</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#CommentsHistory">CommentsHistory</a></li><li><a href="global.html#DateInput">DateInput</a></li><li><a href="global.html#DatePicker">DatePicker</a></li><li><a href="global.html#DateRangePicker">DateRangePicker</a></li><li><a href="global.html#DocumentUpload">DocumentUpload</a></li><li><a href="global.html#DropZone">DropZone</a></li><li><a href="global.html#FileUpload">FileUpload</a></li><li><a href="global.html#ImageUpload">ImageUpload</a></li><li><a href="global.html#InlineDateRangePicker">InlineDateRangePicker</a></li><li><a href="global.html#Login2">Login2</a></li><li><a href="global.html#MultiFileUpload">MultiFileUpload</a></li><li><a href="global.html#TaskCard">TaskCard</a></li><li><a href="global.html#TaskSummaryPage">TaskSummaryPage</a></li><li><a href="global.html#base64ToArrayBuffer">base64ToArrayBuffer</a></li><li><a href="global.html#decrypt">decrypt</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">components/Decryption/Decrypt.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// /**
//  * @fileoverview Simplified Dynamic Decryption Service - AES-256-GCM Only
//  * @module src/services/EnhancedDynamicDecryption
//  * @author Rakshana
//  * @date 26/09/2025
//  * @since 2.1.1
//  */

// import Cookies from 'js-cookie';
// import { HostName } from "src/assets/host/Host";
// const STATIC_ENCRYPTION_KEY = "7xPz!qL3vNc#eRb9Wm@f2Zh8Kd$gYp1B";
// let dynamicDecryptionKey = null;
// let keyFetchTime = null;
// const KEY_CACHE_DURATION = 30 * 60 * 1000;

// /**
//  * Converts base64 string to ArrayBuffer
//  * @param {string} base64 - Base64 encoded string
//  * @returns {ArrayBuffer} Decoded array buffer
//  */
// function base64ToArrayBuffer(base64) {
//   const binaryString = atob(base64);
//   const bytes = new Uint8Array(binaryString.length);
//   for (let i = 0; i &lt; binaryString.length; i++) {
//     bytes[i] = binaryString.charCodeAt(i);
//   }
//   return bytes.buffer;
// }

// /**
//  * Decrypts data using AES-256-GCM
//  * @param {string} encryptedData - Base64 encoded encrypted data
//  * @param {string} encryptionKey - The encryption key to use (32 bytes)
//  * @returns {Promise&lt;string>} Decrypted plain text
//  */
// export const decryptDataWithKey = async (encryptedData, encryptionKey) => {
//   if (!window?.crypto?.subtle) {
//     throw new Error("Web Crypto API not available. Cannot decrypt in this browser.");
//   }

//   if (!encryptedData || typeof encryptedData !== "string") {
//     throw new Error("Invalid encrypted data: must be a non-empty string");
//   }

//   if (!encryptionKey || typeof encryptionKey !== "string") {
//     throw new Error("Invalid encryption key: must be a non-empty string");
//   }

//   try {
//     const encryptedBuffer = base64ToArrayBuffer(encryptedData);
//     const encryptedArray = new Uint8Array(encryptedBuffer);
//     const keyString = encryptionKey.length === 32 ?
//       encryptionKey :
//       (encryptionKey + '00000000000000000000000000000000').substring(0, 32);
//     const keyBytes = new TextEncoder().encode(keyString);
//     const cryptoKey = await window.crypto.subtle.importKey(
//       'raw',
//       keyBytes,
//       { name: 'AES-GCM', length: 256 },
//       false,
//       ['decrypt']
//     );
//     const iv = encryptedArray.slice(0, 12);
//     const ciphertext = encryptedArray.slice(12);
//     const decryptedBuffer = await window.crypto.subtle.decrypt(
//       { name: 'AES-GCM', iv },
//       cryptoKey,
//       ciphertext
//     );

//     const result = new TextDecoder().decode(decryptedBuffer);
//     return result;

//   } catch (error) {
//     throw new Error(`Decryption failed: ${error.message}`);
//   }
// };

// /**
//  * Gets authentication headers for API requests
//  * @returns {Promise&lt;Object>} Headers object with authorization
//  */
// const getAuthHeaders = async () => {
//   const encryptedToken = Cookies.get('HRToken');
//   return {
//     'Content-Type': 'application/json',
//     'Authorization': `Bearer ${encryptedToken}`,
//   };
// };

// /**
//  * Fetches the dynamic decryption key from the API
//  * @returns {Promise&lt;string>} The decryption key
//  */
// export const fetchDecryptionKey = async () => {
//   if (dynamicDecryptionKey &amp;&amp; keyFetchTime &amp;&amp;
//       (Date.now() - keyFetchTime &lt; KEY_CACHE_DURATION)) {
//     return dynamicDecryptionKey;
//   }

//   try {
//     const headers = await getAuthHeaders();
//     const API_TOKEN = 'HRFGVJISOVp1fncC';
//     const sessionId = Cookies.get("session_id");

//     const response = await fetch(`${HostName}/DatadecryptKey`, {
//       method: 'POST',
//       headers: headers,
//       body: JSON.stringify({
//         token: API_TOKEN,
//         session_id: sessionId,
//       })
//     });

//     if (!response.ok) {
//       throw new Error(`HTTP error! status: ${response.status}`);
//     }

//     const encryptedResponse = await response.json();

//     if (!encryptedResponse.Data) {
//       throw new Error('No encrypted data received from decryption key API');
//     }
//     const decryptedData = await decryptDataWithKey(encryptedResponse.Data, STATIC_ENCRYPTION_KEY);
//     const parsedData = JSON.parse(decryptedData);
//     if (parsedData.Status !== 200 || !parsedData.Data?.Records?.[0]?.decryptkey) {
//       throw new Error('Invalid decryption key API response structure');
//     }
//     dynamicDecryptionKey = parsedData.Data.Records[0].decryptkey;
//     keyFetchTime = Date.now();

//     return dynamicDecryptionKey;

//   } catch (error) {
//     throw new Error(`Failed to fetch decryption key: ${error.message}`);
//   }
// };

// /**
//  * Decrypts data using the dynamically fetched decryption key
//  * @param {string} encryptedData - Base64 encoded encrypted data
//  * @returns {Promise&lt;string>} Decrypted plain text
//  */
// export const decryptData = async (encryptedData) => {
//   const decryptionKey = await fetchDecryptionKey();
//   return await decryptDataWithKey(encryptedData, decryptionKey);
// };

// /**
//  * Validates and parses JSON data
//  * @param {string} data - JSON string to validate
//  * @returns {Object} Parsed JSON object
//  */
// export const validateJsonData = (data) => {
//   try {
//     return JSON.parse(data);
//   } catch (error) {
//     throw new Error("Decrypted data is not valid JSON");
//   }
// };

// /**
//  * Decrypts and parses JSON data in one step
//  * @param {string} encryptedData - Base64 encoded encrypted JSON data
//  * @returns {Promise&lt;Object>} Decrypted and parsed JSON object
//  */
// export const decryptAndParseJson = async (encryptedData) => {
//   const decryptedData = await decryptData(encryptedData);
//   return validateJsonData(decryptedData);
// };

// /**
//  * Checks if Web Crypto API is supported
//  * @returns {boolean} True if supported, false otherwise
//  */
// export const isWebCryptoSupported = () => {
//   return !!window?.crypto?.subtle;
// };

// /**
//  * Clears the cached decryption key (useful for testing or forced refresh)
//  */
// export const clearKeyCache = () => {
//   dynamicDecryptionKey = null;
//   keyFetchTime = null;
// };

// /**
//  * Gets the current cached key info (for debugging)
//  * @returns {Object} Key cache information
//  */
// export const getKeyCacheInfo = () => {
//   return {
//     hasKey: !!dynamicDecryptionKey,
//     fetchTime: keyFetchTime,
//     isExpired: keyFetchTime ? (Date.now() - keyFetchTime >= KEY_CACHE_DURATION) : true,
//     cacheValidFor: keyFetchTime ? Math.max(0, KEY_CACHE_DURATION - (Date.now() - keyFetchTime)) : 0
//   };
// };
// export default {
//   decryptData,
//   decryptDataWithKey,
//   validateJsonData,
//   decryptAndParseJson,
//   isWebCryptoSupported,
//   fetchDecryptionKey,
//   clearKeyCache,
//   getKeyCacheInfo,
// };

/**
 * @fileoverview Easy Dynamic Decryption Service - AES-256-GCM Only
 * @module src/services/EnhancedDynamicDecryption
 * @author Rakshana
 * @date 26/09/2025
 * @since 2.1.1
 */

import Cookies from "js-cookie";
import { HostName } from "src/assets/host/Host";

const STATIC_ENCRYPTION_KEY = "7xPz!qL3vNc#eRb9Wm@f2Zh8Kd$gYp1B";
let dynamicDecryptionKey = null;
let keyFetchTime = null;
const KEY_CACHE_DURATION = 30 * 60 * 1000; // 30 minutes

/**
 * Turns a Base64 text into computer-readable format.
 * @param {string} base64 - Text in Base64 format
 * @returns {ArrayBuffer} Data in binary format
 */
function base64ToArrayBuffer(base64) {
  const binaryString = atob(base64);
  const bytes = new Uint8Array(binaryString.length);
  for (let i = 0; i &lt; binaryString.length; i++) {
    bytes[i] = binaryString.charCodeAt(i);
  }
  return bytes.buffer;
}

/**
 * Decrypts locked data using a secret key.
 * @param {string} encryptedData - The locked (encrypted) text
 * @param {string} encryptionKey - The secret key (32 characters)
 * @returns {Promise&lt;string>} The unlocked (plain) text
 */
export const decryptDataWithKey = async (encryptedData, encryptionKey) => {
  if (!window?.crypto?.subtle) {
    throw new Error("Your browser does not support secure decryption.");
  }

  if (!encryptedData || typeof encryptedData !== "string") {
    throw new Error("Encrypted data must be a non-empty text.");
  }

  if (!encryptionKey || typeof encryptionKey !== "string") {
    throw new Error("Encryption key must be a non-empty text.");
  }

  try {
    const encryptedBuffer = base64ToArrayBuffer(encryptedData);
    const encryptedArray = new Uint8Array(encryptedBuffer);

    // Make sure the key is always 32 characters
    const keyString =
      encryptionKey.length === 32
        ? encryptionKey
        : (encryptionKey + "00000000000000000000000000000000").substring(0, 32);

    const keyBytes = new TextEncoder().encode(keyString);
    const cryptoKey = await window.crypto.subtle.importKey(
      "raw",
      keyBytes,
      { name: "AES-GCM", length: 256 },
      false,
      ["decrypt"]
    );

    // First 12 characters are "IV" (needed for decryption)
    const iv = encryptedArray.slice(0, 12);
    const ciphertext = encryptedArray.slice(12);

    const decryptedBuffer = await window.crypto.subtle.decrypt(
      { name: "AES-GCM", iv },
      cryptoKey,
      ciphertext
    );

    return new TextDecoder().decode(decryptedBuffer);
  } catch (error) {
    throw new Error(`Internal error: ${error.message}`);
  }
};

/**
 * Prepares headers for API requests (with user token).
 * @returns {Promise&lt;Object>} Headers with login info
 */
const getAuthHeaders = async () => {
  const encryptedToken = Cookies.get("HRToken");
  return {
    "Content-Type": "application/json",
    Authorization: `Bearer ${encryptedToken}`,
  };
};

/**
 * Gets a fresh secret key from the server.
 * (Reuses old one if itâ€™s still valid for 30 minutes.)
 * @returns {Promise&lt;string>} The secret key
 */
export const fetchDecryptionKey = async () => {
  if (
    dynamicDecryptionKey &amp;&amp;
    keyFetchTime &amp;&amp;
    Date.now() - keyFetchTime &lt; KEY_CACHE_DURATION
  ) {
    return dynamicDecryptionKey;
  }

  try {
    const headers = await getAuthHeaders();
    const API_TOKEN = "HRFGVJISOVp1fncC";
    const sessionId = Cookies.get("session_id");

    const response = await fetch(`${HostName}/DatadecryptKey`, {
      method: "POST",
      headers: headers,
      body: JSON.stringify({
        token: API_TOKEN,
        session_id: sessionId,
      }),
    });

    if (!response.ok) {
      throw new Error(`Server error: ${response.status}`);
    }

    const encryptedResponse = await response.json();
    if (!encryptedResponse.Data) {
      throw new Error("No secret key received from server");
    }

    // Unlock the server response using the static key
    const decryptedData = await decryptDataWithKey(
      encryptedResponse.Data,
      STATIC_ENCRYPTION_KEY
    );
    const parsedData = JSON.parse(decryptedData);

    if (
      parsedData.Status !== 200 ||
      !parsedData.Data?.Records?.[0]?.decryptkey
    ) {
      throw new Error("Server returned invalid secret key structure");
    }

    dynamicDecryptionKey = parsedData.Data.Records[0].decryptkey;
    keyFetchTime = Date.now();

    return dynamicDecryptionKey;
  } catch (error) {
    throw new Error(`Failed to get secret key: ${error.message}`);
  }
};

/**
 * Decrypts locked text using the latest server key.
 * @param {string} encryptedData - The locked (encrypted) text
 * @returns {Promise&lt;string>} The unlocked (plain) text
 */
export const decryptData = async (encryptedData) => {
  const decryptionKey = await fetchDecryptionKey();
  return await decryptDataWithKey(encryptedData, decryptionKey);
};

/**
 * Makes sure the unlocked data is proper JSON.
 * @param {string} data - Text to check
 * @returns {Object} Parsed JSON object
 */
export const validateJsonData = (data) => {
  try {
    return JSON.parse(data);
  } catch (error) {
    throw new Error("Unlocked data is not valid JSON.");
  }
};

/**
 * Unlocks data and turns it into JSON in one step.
 * @param {string} encryptedData - Locked JSON text
 * @returns {Promise&lt;Object>} Unlocked and parsed JSON
 */
export const decryptAndParseJson = async (encryptedData) => {
  const decryptedData = await decryptData(encryptedData);
  return validateJsonData(decryptedData);
};

/**
 * Checks if your browser supports secure decryption.
 * @returns {boolean} True if supported
 */
export const isWebCryptoSupported = () => {
  return !!window?.crypto?.subtle;
};

/**
 * Clears the saved secret key (forces new fetch).
 */
export const clearKeyCache = () => {
  dynamicDecryptionKey = null;
  keyFetchTime = null;
};

/**
 * Shows info about the saved key (for debugging).
 * @returns {Object} Info about key status and time left
 */
export const getKeyCacheInfo = () => {
  return {
    hasKey: !!dynamicDecryptionKey,
    fetchTime: keyFetchTime,
    isExpired: keyFetchTime
      ? Date.now() - keyFetchTime >= KEY_CACHE_DURATION
      : true,
    cacheValidFor: keyFetchTime
      ? Math.max(0, KEY_CACHE_DURATION - (Date.now() - keyFetchTime))
      : 0,
  };
};

export default {
  decryptData,
  decryptDataWithKey,
  validateJsonData,
  decryptAndParseJson,
  isWebCryptoSupported,
  fetchDecryptionKey,
  clearKeyCache,
  getKeyCacheInfo,
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Wed Nov 05 2025 11:24:43 GMT+0530 (India Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
